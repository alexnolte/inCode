\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
    \usepackage{xltxtra,xunicode}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{â‚¬}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\ifxetex
  \usepackage[setpagesize=false, % page size defined by xetex
              unicode=false, % unicode breaks when used with xetex
              xetex]{hyperref}
\else
  \usepackage[unicode=true]{hyperref}
\fi
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={Justin Le},
            pdftitle={Adjunctions in the wild: foldl},
            colorlinks=true,
            citecolor=blue,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
% Make links footnotes instead of hotlinks:
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{0}

\title{Adjunctions in the wild: foldl}
\author{Justin Le}

\begin{document}
\maketitle

\emph{Originally posted on
\textbf{\href{https://blog.jle.im/entry/foldl-adjunction.html}{in Code}}.}

I recently made a few connections that linked some different concepts in Haskell
that I hadn't realized before.

\hypertarget{foldl}{%
\section{foldl}\label{foldl}}

The first concept is the great
\emph{\href{http://hackage.haskell.org/package/foldl}{foldl}} library, which
provides a nice ``stream processor'' type called \texttt{Fold}, where
\texttt{Fold\ r\ a} is a stream processor that takes a stream of \texttt{r}s and
produces an \texttt{a}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\OtherTok{  ::} \DataTypeTok{Num}\NormalTok{ a        }\OtherTok{=>} \DataTypeTok{Fold}\NormalTok{ a a}
\OtherTok{mean ::} \DataTypeTok{Fractional}\NormalTok{ a }\OtherTok{=>} \DataTypeTok{Fold}\NormalTok{ a a}
\FunctionTok{elem}\OtherTok{ ::} \DataTypeTok{Eq}\NormalTok{ a         }\OtherTok{=>}\NormalTok{ a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ a }\DataTypeTok{Bool}

\NormalTok{fold }\FunctionTok{sum}\NormalTok{  [}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{]}
\PreprocessorTok{\#   => 10}
\NormalTok{fold mean [}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{]}
\PreprocessorTok{\#   => 2.5}
\NormalTok{fold (}\FunctionTok{elem} \DecValTok{3}\NormalTok{) [}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{]}
\PreprocessorTok{\#   => True}
\NormalTok{fold (}\FunctionTok{elem} \DecValTok{5}\NormalTok{) [}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{]}
\PreprocessorTok{\#   => False}
\end{Highlighting}
\end{Shaded}

The most useful thing about the library is that it treats the folds as
first-class objects, so you can create more complex folds by combining simpler
folds

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\{{-}\# LANGUAGE ApplicativeDo \#{-}\}}

\OtherTok{variance ::} \DataTypeTok{Fractional}\NormalTok{ a }\OtherTok{=>} \DataTypeTok{Fold}\NormalTok{ a a}
\NormalTok{variance }\OtherTok{=} \KeywordTok{do}
\NormalTok{    m  }\OtherTok{<{-}}\NormalTok{ mean}
\NormalTok{    m2 }\OtherTok{<{-}}\NormalTok{ lmap (}\OperatorTok{\^{}}\DecValTok{2}\NormalTok{) mean     }\CommentTok{{-}{-} the mean of squared items}
    \FunctionTok{pure}\NormalTok{ (m2 }\OperatorTok{{-}}\NormalTok{ m}\OperatorTok{*}\NormalTok{m)}

\OtherTok{varianceTooBig ::} \DataTypeTok{Fractional}\NormalTok{ a }\OtherTok{=>} \DataTypeTok{Fold}\NormalTok{ a }\DataTypeTok{Bool}
\NormalTok{varianceTooBig }\OtherTok{=}\NormalTok{ (}\OperatorTok{>} \DecValTok{3}\NormalTok{) }\OperatorTok{<$>}\NormalTok{ variance}
\end{Highlighting}
\end{Shaded}

Most importantly, \texttt{Fold\ r} is an instance of both \texttt{Functor} and
\texttt{Applicative}, so you can map over and combine the results of different
folds.

\hypertarget{adjunctions}{%
\section{Adjunctions}\label{adjunctions}}

The second concept is the idea of
\emph{\href{https://en.wikipedia.org/wiki/Adjoint_functors}{adjoint functors}}
(see also \href{https://bartoszmilewski.com/2016/04/18/adjunctions/}{Bartosz
Milewski's introduction} and
\href{https://ncatlab.org/nlab/show/adjoint+functor}{nlab}'s description),
represented in Haskell by the
\emph{\href{https://hackage.haskell.org/package/adjunctions/docs/Data-Functor-Adjunction.html}{adjunctions}}
library and typeclass
(\href{https://chrispenner.ca/posts/adjunction-battleship}{Chris Penner} has a
nice article with an example of using the typeclass).

The idea is that, for some functors, we can think of a ``conceptual inverse''.
We can ask ``I have a nice functor \texttt{F}. Conceptually, what functor
represents the opposite idea/spirit of \texttt{F}?'' The concept of an
adjunction is one way to formalize what this means. The high-level idea is that
if \texttt{F\ -\textbar{}\ G} (\texttt{F} is left adjoint to \texttt{G}, and
\texttt{G} is right adjoint to \texttt{F}), then all the ways of going ``out
of'' \texttt{F\ a} to \texttt{b} are the same as all the ways of going ``into''
\texttt{G\ b} from \texttt{a}. Ways of going out can be encoded as ways of going
in, and vice versa. They represent opposite ideas.

\hypertarget{examples}{%
\subsection{Examples}\label{examples}}

For example, one of the more famous adjunctions in Haskell is the adjunction
between \texttt{(,)\ r} and \texttt{(-\textgreater{})\ r}. ``Tupling''
represents some sort of ``opposite'' idea to ``parameterizing''.

The ways to get ``out'' of a tuple is \texttt{(r,\ a)\ -\textgreater{}\ b}. The
ways to go ``into'' a function is
\texttt{a\ -\textgreater{}\ (r\ -\textgreater{}\ b)}. Haskellers will recognize
that these two types are the ``same'' (isomorphic) --- any
\texttt{(a,\ b)\ -\textgreater{}\ c} can be re-written as
\texttt{a\ -\textgreater{}\ (b\ -\textgreater{}\ c)} (currying), and vice versa
(uncurrying).

Another common pair is with same-typed either and tuple:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{newtype} \DataTypeTok{SameEither}\NormalTok{ a }\OtherTok{=} \DataTypeTok{SE}\NormalTok{ (}\DataTypeTok{Either}\NormalTok{ a a)}
\KeywordTok{newtype} \DataTypeTok{SameTuple}\NormalTok{  a }\OtherTok{=} \DataTypeTok{ST}\NormalTok{ (a, a)}
\end{Highlighting}
\end{Shaded}

People familiar with \texttt{Either} (sums) and \texttt{(,)} (products) in
Haskell will recognize them as ``opposite'' ideas --- one is ``or'', and the
other is ``and'' (depending on if you are talking about using them or making
them).

We can formalize this idea of opposites using adjunctions: Going ``out of''
\texttt{Either\ a\ a} into \texttt{b} can be encoded as going ``into''
\texttt{(b,\ b)} from \texttt{a},m and vice versa:
\texttt{Either\ a\ a\ -\textgreater{}\ b} can be encoded as
\texttt{a\ -\textgreater{}\ (b,\ b)} (and vice versa) --- the two types are
isomorphic. This is because to go out of \texttt{Either\ a\ a}, you have to
handle the situation of getting a \texttt{Left} and the situation of getting a
\texttt{Right}. To go into \texttt{(b,\ b)}, you have to able to ask what goes
in the first field, and what goes in the right field. Both
\texttt{Either\ a\ a\ -\textgreater{}\ b} and
\texttt{a\ -\textgreater{}\ (b,\ b)} have to answer the same questions. (A fun
exercise would be to write the functions to convert between the two)

\hypertarget{big-picture}{%
\subsection{Big Picture}\label{big-picture}}

Aside from being an interesting curiosity (formalizing the idea of ``opposite
idea'' is pretty neat), hunting for adjunctions can be useful in figuring out
``why'' a functor is useful, what you can do with it, and also what functors are
intimately connected with it. There's also the helper functions in the
\href{https://hackage.haskell.org/package/adjunctions/docs/Data-Functor-Adjunction.html}{Data.Functor.Adjunction}
module that implement some nice helper functions on your types if an adjoint
happens to exist --- you can do some neat things by going ``back and forth''
between adjoint functors.

\hypertarget{hunting-for-adjunctions}{%
\section{Hunting for Adjunctions}\label{hunting-for-adjunctions}}

So, from the build-up, you've probably guessed what we're going to do next: find
a functor that is adjoint to \texttt{Fold\ r}. If you guessed that \ldots{}
you're right! Let's go adjunction hunting!

Important note --- the rest of this section is not a set of hard rules, but
rather an intuitive process of heuristics to search for candidates that would be
adjoint to a given functor of interest. There are no hard and fast rules, and
the adjoint might not always exist --- it usually doesn't. But when it does, it
can be a pleasant surprise.

\hypertarget{patterns-to-look-for}{%
\subsection{Patterns to look for}\label{patterns-to-look-for}}

Now, on to the hunting. Let's say we have functor \texttt{Q} and we want to
identify any adjoints. We want to spot functions that use both \texttt{Q\ a} and
\texttt{a} with some other value, in
\href{https://www.foldl.io/posts/pos-neg-functions/}{opposite positions}.

(Of course, this is only the case if we are using a functor that comes from a
library. If we are writing our own functor from scratch, and want to hunt for
adjunctions there, we have to instead \emph{think} of ways to use \texttt{Q\ a}
and \texttt{a})

One common pattern is functions for ``converting between'' the going-in and
going-out functions. In
\href{https://hackage.haskell.org/package/adjunctions/docs/Data-Functor-Adjunction.html}{Data.Functor.Adjunctions},
these are called \texttt{leftAdjunct} and \texttt{rightAdjunct}:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{leftAdjunct  ::} \DataTypeTok{Adjunction}\NormalTok{ f u }\OtherTok{=>}\NormalTok{ (f a }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>}\NormalTok{ (a }\OtherTok{{-}>}\NormalTok{ u b)}
\OtherTok{rightAdjunct ::} \DataTypeTok{Adjunction}\NormalTok{ f u }\OtherTok{=>}\NormalTok{ (a }\OtherTok{{-}>}\NormalTok{ u b) }\OtherTok{{-}>}\NormalTok{ (f a }\OtherTok{{-}>}\NormalTok{ b)}
\end{Highlighting}
\end{Shaded}

These will often come in pairs, and they are significant because they are
essentially the adjunctions ``in practice'': Sure, an
\texttt{(r,\ a)\ -\textgreater{}\ b} is useful, but ``using'' the adjunction
means that you can convert between \texttt{(r,\ a)\ -\textgreater{}\ b}
(\texttt{uncurry}) and backwards.

Basically, any time \texttt{Q\ a} is spotted with \texttt{a} with opposite
polarity, it's something to investigate.

Another common pattern that you can spot are ``indexing'' and ``tabulating''
functions, in the case that you have a right-adjoint:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{indexAdjunction    ::} \DataTypeTok{Adjunction}\NormalTok{ f u }\OtherTok{=>}\NormalTok{ u b }\OtherTok{{-}>}\NormalTok{ f () }\OtherTok{{-}>}\NormalTok{ b}
\OtherTok{tabulateAdjunction ::} \DataTypeTok{Adjunction}\NormalTok{ f u }\OtherTok{=>}\NormalTok{ (f () }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>}\NormalTok{ u b}
\end{Highlighting}
\end{Shaded}

These also come in pairs! And it's possible to write the other pair
(\texttt{leftAdjunct} and \texttt{rightAdjunct}) in terms of this pair, actually
--- so finding one is finding the other.

\texttt{indexAdjunction} means: if it's possible to ``extract'' from
\texttt{u\ b} to \texttt{b} using only an \texttt{f\ ()} as extra information,
then \texttt{u} might be right-adjoint to \texttt{f}.

\texttt{tabulateAdjunction} means: if it's possible to ``generate'' a
\texttt{u\ b} based on a function that ``builds'' a \texttt{b} from
\texttt{f\ ()}, then \texttt{u} might right-adjoint to \texttt{f}.

\hypertarget{adjoints-to-fold}{%
\subsection{\texorpdfstring{Adjoints to
\texttt{Fold}}{Adjoints to Fold}}\label{adjoints-to-fold}}

In the case of \texttt{Fold}, there is actually only one function that takes a
\texttt{Fold\ r\ a} and returns an \texttt{a}:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{fold ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>}\NormalTok{ [r] }\OtherTok{{-}>}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

(the type has been simplified and re-labeled, for illustration's sake)

You ``give'' a \texttt{Fold\ r\ b} and ``get'' an \texttt{b} (and so they have
opposite polarities/positions). This sort of function would make
\texttt{Fold\ r} a \emph{right adjoint}, since the naked type \texttt{b} is the
final result, not the input.

Of our common patterns, this one looks a looooot like \texttt{indexAdjunction}.

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{fold            ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>}\NormalTok{ [r]  }\OtherTok{{-}>}\NormalTok{ b}
\OtherTok{indexAdjunction ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>}\NormalTok{ f () }\OtherTok{{-}>}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

This means that \texttt{Fold\ r\ b} is right-adjoint to some functor \texttt{f}
where \texttt{f\ ()\ =\ {[}r{]}}. A good first guess (just a hunch?) would be to
just have \texttt{f\ a\ =\ ({[}r{]},\ a)}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data} \DataTypeTok{EnvList}\NormalTok{ r a }\OtherTok{=} \DataTypeTok{EnvList}\NormalTok{ [r] a}
  \KeywordTok{deriving}\NormalTok{ (}\DataTypeTok{Show}\NormalTok{, }\DataTypeTok{Eq}\NormalTok{, }\DataTypeTok{Ord}\NormalTok{, }\DataTypeTok{Functor}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\texttt{EnvList\ r} is essentially just a \emph{list} of \texttt{r}s. It is now
also our suspect for a potential left-adjoint to \texttt{Fold\ r}: a
``conceptual opposite''.

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{indexFold ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>} \DataTypeTok{EnvList}\NormalTok{ r () }\OtherTok{{-}>}\NormalTok{ b}
\NormalTok{indexFold fld (}\DataTypeTok{EnvList}\NormalTok{ rs \_) }\OtherTok{=}\NormalTok{ fold f rs}
\end{Highlighting}
\end{Shaded}

To seal the deal, let's find its pair, \texttt{tabulateAdjunction}. That means
we are looking for:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{tabulateFold ::}\NormalTok{ (}\DataTypeTok{EnvList}\NormalTok{ r () }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}
\end{Highlighting}
\end{Shaded}

Or, to simplify the type by expanding the definition of \texttt{EnvList\ r\ ()}:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{tabulateFold ::}\NormalTok{ ([r] }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}
\end{Highlighting}
\end{Shaded}

This tells us that, given any list processor
\texttt{{[}r{]}\ -\textgreater{}\ b}, we can write a fold \texttt{Fold\ r\ b}
representing that list processor. Scanning things more, we can see that this
actually looks a lot like \texttt{foldMap} from the library:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{import} \KeywordTok{qualified} \DataTypeTok{Control.Foldl} \KeywordTok{as} \DataTypeTok{F}

\NormalTok{F.foldMap}
\OtherTok{    ::} \DataTypeTok{Monoid}\NormalTok{ w}
    \OtherTok{=>}\NormalTok{ (r }\OtherTok{{-}>}\NormalTok{ w)}
    \OtherTok{{-}>}\NormalTok{ (w }\OtherTok{{-}>}\NormalTok{ b)}
    \OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}

\CommentTok{{-}{-} or}

\NormalTok{F.foldMap (\textbackslash{}r }\OtherTok{{-}>}\NormalTok{ [r])}
\OtherTok{    ::}\NormalTok{ ([r] }\OtherTok{{-}>}\NormalTok{ b)}
    \OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}
\end{Highlighting}
\end{Shaded}

So:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{tabulateFold ::}\NormalTok{ (}\DataTypeTok{EnvList}\NormalTok{ r () }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}
\NormalTok{tabulateFold f }\OtherTok{=}\NormalTok{ F.foldMap (\textbackslash{}r }\OtherTok{{-}>} \DataTypeTok{EnvList}\NormalTok{ [r] ())}
\end{Highlighting}
\end{Shaded}

And\ldots that gives us a pretty strong footing to claim that
\texttt{EnvList\ r} is the left-adjoint of \texttt{Fold\ r}.

Note that if we had missed \texttt{fold} during our adjunction hunt, we might
have also lucked out by noticing
\texttt{F.foldMap\ (\textbackslash{}r\ -\textgreater{}\ {[}r{]})} fitting the
criteria for a candidate for \texttt{tabulateAdjunction}, instead.

\hypertarget{opposite-concepts}{%
\section{Opposite Concepts}\label{opposite-concepts}}

We've identified a likely candidate for a left-adjoint to \texttt{Fold\ r}! But
\ldots{} does any of this make any sense? Does this make sense as a
left-adjoint, conceptually \ldots{} and did we gain anything?

Let's think about this from the beginning: What is the conceptual opposite of
``something that folds a list''?

Well, what other thing is more naturally an opposite than ``a list to be
folded''!

\begin{itemize}
\tightlist
\item
  \texttt{EnvList\ r}: Is a list of \texttt{r}
\item
  \texttt{Fold\ r}: Consumes a list of \texttt{r}
\end{itemize}

Or, in terms of the result of the functor application:

\begin{itemize}
\tightlist
\item
  \texttt{EnvList\ r\ a}

  \begin{itemize}
  \tightlist
  \item
    A list of \texttt{r}
  \item
    Tuplied with an \texttt{a}
  \end{itemize}
\item
  \texttt{Fold\ r\ a}

  \begin{itemize}
  \tightlist
  \item
    Consumes a list of \texttt{r}
  \item
    Produces an \texttt{a} as a result
  \end{itemize}
\end{itemize}

It seems to ``flip'' the idea of ``list vs.~list consumer'', and \emph{also} the
idea of ``tupled vs.~producing''.

In addition, lists seem to be at the heart of how to create and consume a
\texttt{Fold\ r}.

\texttt{fold} can be thought of as the fundamental way to \emph{consuming} a
\texttt{Fold\ r}. This makes the adjunction against \texttt{EnvList\ r} make
sense: what good is the \emph{ability} to fold \ldots{} if there is nothing
\emph{to fold}? \texttt{EnvList\ r} (a list of \texttt{{[}r{]}}) is intimately
related to \texttt{Fold\ r}: they are the yin and yang, peanut butter and jelly,
night and day. Their fates are intertwined from their very inception. You cannot
have one without the other.

In addition, \texttt{F.foldMap} is arguably the fundamental way to
\emph{construct} a \texttt{Fold\ r}. A \texttt{Fold\ r} is, fundamentally, a
list processor --- which is what \texttt{EnvList\ r\ a\ -\textgreater{}\ b}
literally is (an \texttt{{[}r{]}\ -\textgreater{}\ b}). \texttt{Fold\ r} and
\texttt{EnvList\ r} ---
\href{https://starwars.fandom.com/wiki/Dyad_in_the_Force}{dyads in the force}.
Or, well\ldots I guess literally monads, since
\href{http://www.stephendiehl.com/posts/adjunctions.html}{all adjunctions give
rise to monads}\ldots and comonads too.

The fact that \texttt{EnvList\ r} and \texttt{Fold\ r} form an adjunction
together formalizes the fact that they are conceptually ``opposite'' concepts,
and also that they are bound together by destiny in a close and fundamental way.

\hypertarget{investigations}{%
\section{Investigations}\label{investigations}}

Let's take a look at some of the useful helper functions that an instance of
\texttt{Adjunction} gives us for \texttt{Fold\ r}. For all of these, I'm going
to write them first as \texttt{EnvList\ r\ a}, and then also as
\texttt{({[}r{]},\ a)}, to help make things clearer.

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{unit ::}\NormalTok{ a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r (}\DataTypeTok{EnvList}\NormalTok{ r a)}
\OtherTok{unit ::}\NormalTok{ a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r ([r], a)}

\OtherTok{counit ::} \DataTypeTok{EnvList}\NormalTok{ r (}\DataTypeTok{Fold}\NormalTok{ r a) }\OtherTok{{-}>}\NormalTok{ a}
\OtherTok{counit ::}\NormalTok{ [r] }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r a }\OtherTok{{-}>}\NormalTok{ a}

\OtherTok{leftAdjunct ::}\NormalTok{ (}\DataTypeTok{EnvList}\NormalTok{ r a }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>}\NormalTok{ (a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b)}
\OtherTok{leftAdjunct ::}\NormalTok{ ([r] }\OtherTok{{-}>}\NormalTok{ a }\OtherTok{{-}>}\NormalTok{ b   ) }\OtherTok{{-}>}\NormalTok{ (a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b)}

\OtherTok{rightAdjunct ::}\NormalTok{ (a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b) }\OtherTok{{-}>}\NormalTok{ (}\DataTypeTok{EnvList}\NormalTok{ r a }\OtherTok{{-}>}\NormalTok{ b)}
\OtherTok{rightAdjunct ::}\NormalTok{ (a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b) }\OtherTok{{-}>}\NormalTok{ ([r] }\OtherTok{{-}>}\NormalTok{ a }\OtherTok{{-}>}\NormalTok{ b   )}

\OtherTok{tabulateAdjunction ::}\NormalTok{ (}\DataTypeTok{EnvList}\NormalTok{ r () }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}
\OtherTok{tabulateAdjunction ::}\NormalTok{ ([r] }\OtherTok{{-}>}\NormalTok{ b)          }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}

\OtherTok{indexAdjunction ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>} \DataTypeTok{EnvList}\NormalTok{ r a }\OtherTok{{-}>}\NormalTok{ b}
\OtherTok{indexAdjunction ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>}\NormalTok{ [r]         }\OtherTok{{-}>}\NormalTok{ b}

\OtherTok{zipR ::} \DataTypeTok{Fold}\NormalTok{ r a }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r (a, b)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \texttt{unit\ ::\ a\ -\textgreater{}\ Fold\ r\ ({[}r{]},\ a)}, when we
  specialize \texttt{a\ \textasciitilde{}\ ()}, becomes:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{unit ::} \DataTypeTok{Fold}\NormalTok{ r [r]}
\end{Highlighting}
\end{Shaded}

  This means that \texttt{unit} for \texttt{Fold\ r} folds a list
  \texttt{{[}r{]}} into ``itself'':

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fold unit [}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{]}
\PreprocessorTok{\#   => [1,2,3]}
\end{Highlighting}
\end{Shaded}
\item
  \texttt{counit\ ::\ {[}r{]}\ -\textgreater{}\ Fold\ r\ a\ -\textgreater{}\ a}
  is essentially just \texttt{fold}. Neat!
\item
  \texttt{leftAdjunct\ ::\ ({[}r{]}\ -\textgreater{}\ a\ -\textgreater{}\ b)\ -\textgreater{}\ (a\ -\textgreater{}\ Fold\ r\ b)}
  \ldots{} if we write it as
  \texttt{leftAdjunct\ ::\ a\ -\textgreater{}\ (a\ -\textgreater{}\ {[}r{]}\ -\textgreater{}\ b)\ -\textgreater{}\ Fold\ r\ b},
  and feed the \texttt{a} into the first function, we get:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{leftAdjunct\textquotesingle{} ::}\NormalTok{ ([r] }\OtherTok{{-}>}\NormalTok{ b) }\OtherTok{{-}>} \DataTypeTok{Fold}\NormalTok{ r b}
\end{Highlighting}
\end{Shaded}

  which is just \texttt{tabulateAdjunction}, or
  \texttt{F.foldMap\ (\textbackslash{}r\ -\textgreater{}\ {[}r{]})}! It encodes
  our list processor \texttt{{[}r{]}\ -\textgreater{}\ b} into a
  \texttt{Fold\ r\ b.}
\item
  \texttt{rightAdjunct\ ::\ (a\ -\textgreater{}\ Fold\ r\ b)\ -\textgreater{}\ ({[}r{]}\ -\textgreater{}\ a\ -\textgreater{}\ b)}
  -- if we again rewrite as
  \texttt{rightAdjunct\ ::\ a\ -\textgreater{}\ (a\ -\textgreater{}\ Fold\ r\ b)\ -\textgreater{}\ {[}r{]}\ -\textgreater{}\ b},
  and again feed the \texttt{a} into the first function, becomes:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{rightAdjunct\textquotesingle{} ::} \DataTypeTok{Fold}\NormalTok{ r b }\OtherTok{{-}>}\NormalTok{ [r] }\OtherTok{{-}>}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

  Which is just \texttt{fold}, or \texttt{counit}!

  Note that \texttt{leftAdjunct} and \texttt{rightAdjunct} aren't always this
  cleanly rearranged into \texttt{tabulate} or \texttt{counit} etc. -- in this
  case it's just because of how \texttt{EnvList\ r\ a} is shaped.
\item
  \texttt{tabulateAdjunction} and \texttt{indexAdjunction} we went over earlier,
  seeing them as
  \texttt{F.foldMap\ (\textbackslash{}r\ -\textgreater{}\ {[}r{]})} and
  \texttt{fold}
\item
  \texttt{zipR\ ::\ Fold\ r\ a\ -\textgreater{}\ Fold\ r\ b\ -\textgreater{}\ Fold\ r\ (a,\ b)}
  takes two \texttt{Fold\ r}s and combines them into a single fold. This is
  exactly the ``combining fold'' behavior that makes \texttt{Fold}s so useful!
  The implementation of \texttt{zipR} is less efficient than the implementation
  of \texttt{\textless{}*\textgreater{}}/\texttt{liftA2} for \texttt{Fold\ r},
  but knowing that \texttt{zipR} exists means that we know \texttt{Fold\ r}s can
  be combined.
\end{enumerate}

\hypertarget{signoff}{%
\section{Signoff}\label{signoff}}

Hi, thanks for reading! You can reach me via email at
\href{mailto:justin@jle.im}{\nolinkurl{justin@jle.im}}, or at twitter at
\href{https://twitter.com/mstk}{@mstk}! This post and all others are published
under the \href{https://creativecommons.org/licenses/by-nc-nd/3.0/}{CC-BY-NC-ND
3.0} license. Corrections and edits via pull request are welcome and encouraged
at \href{https://github.com/mstksg/inCode}{the source repository}.

If you feel inclined, or this post was particularly helpful for you, why not
consider \href{https://www.patreon.com/justinle/overview}{supporting me on
Patreon}, or a \href{bitcoin:3D7rmAYgbDnp4gp4rf22THsGt74fNucPDU}{BTC donation}?
:)

\end{document}
